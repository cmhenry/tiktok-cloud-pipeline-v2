[Unit]
Description=Audio Pipeline Transfer Worker (AWS EC2 -> S3)
After=network.target
Wants=network-online.target

[Service]
Type=simple
User={{ app_user }}
Group={{ app_group }}
WorkingDirectory={{ pipeline_dir }}

# Environment variables
Environment=PYTHONUNBUFFERED=1

# Redis connection
Environment=REDIS_HOST={{ redis_host }}
Environment=REDIS_PORT={{ redis_port }}

# S3 configuration
Environment=S3_ENDPOINT={{ s3_endpoint }}
Environment=S3_ACCESS_KEY={{ s3_access_key }}
Environment=S3_SECRET_KEY={{ s3_secret_key }}
Environment=S3_BUCKET={{ s3_bucket }}

# AWS transfer settings (from config.py defaults, can be overridden)
# Environment=AWS_SOURCE_HOST=tt-zrh
# Environment=AWS_SOURCE_PATH=/mnt/hub/export/sound

# Logging
Environment=LOG_DIR={{ log_dir }}

# Execute
ExecStart={{ pipeline_venv }}/bin/python -m src.transfer_sounds

# Restart policy
Restart=always
RestartSec=10

# Resource limits
LimitNOFILE=65535

# Logging
StandardOutput=journal
StandardError=journal
SyslogIdentifier=transfer-worker

[Install]
WantedBy=multi-user.target
